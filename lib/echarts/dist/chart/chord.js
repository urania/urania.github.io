define("echarts/chart/chord",["require","../component/base","./base","zrender/shape/Text","zrender/shape/Line","zrender/shape/Sector","../util/shape/Ribbon","../util/shape/Icon","zrender/shape/BezierCurve","../config","../util/ecData","zrender/tool/util","zrender/tool/vector","../data/Graph","../layout/Chord","../chart"],function(t){"use strict";function e(t,e,r,n,s){i.call(this,t,e,r,n,s),o.call(this),this.scaleLineLength=4,this.scaleUnitAngle=4,this.refresh(n)}var i=t("../component/base"),o=t("./base"),r=t("zrender/shape/Text"),n=t("zrender/shape/Line"),s=t("zrender/shape/Sector"),a=t("../util/shape/Ribbon"),h=t("../util/shape/Icon"),l=t("zrender/shape/BezierCurve"),d=t("../config"),c=t("../util/ecData"),u=t("zrender/tool/util"),p=t("zrender/tool/vector"),f=t("../data/Graph"),g=t("../layout/Chord");return e.prototype={type:d.CHART_TYPE_CHORD,_init:function(){var t=this.series;this.selectedMap={};for(var e={},i={},o=0,r=t.length;r>o;o++)if(t[o].type===this.type){var n=this.isSelected(t[o].name);this.selectedMap[t[o].name]=n,n&&this.buildMark(o),this.reformOption(t[o]),e[t[o].name]=t[o]}for(var o=0,r=t.length;r>o;o++)if(t[o].type===this.type)if(t[o].insertToSerie){var s=e[t[o].insertToSerie];t[o]._referenceSerie=s}else i[t[o].name]=[t[o]];for(var o=0,r=t.length;r>o;o++)if(t[o].type===this.type&&t[o].insertToSerie){for(var a=t[o]._referenceSerie;a&&a._referenceSerie;)a=a._referenceSerie;i[a.name]&&this.selectedMap[t[o].name]&&i[a.name].push(t[o])}for(var h in i)this._buildChords(i[h]);this.addShapeList()},_getNodeCategory:function(t,e){return t.categories&&t.categories[e.category||0]},_getNodeQueryTarget:function(t,e){var i=this._getNodeCategory(t,e);return[e,i,t]},_getEdgeQueryTarget:function(t,e,i){return i=i||"normal",[e.itemStyle&&e.itemStyle[i],t.itemStyle[i].chordStyle]},_buildChords:function(t){for(var e=[],i=t[0],o=function(t){return t.layout.size>0},r=0;r<t.length;r++){var n=t[r];if(this.selectedMap[n.name]){var s;n.data&&n.matrix?s=this._getSerieGraphFromDataMatrix(n,i):n.nodes&&n.links&&(s=this._getSerieGraphFromNodeLinks(n,i)),s.filterNode(o,this),e.push(s),s.__serie=n}}if(e.length){var a=e[0];if(!i.ribbonType){var h=i.minRadius,l=i.maxRadius,d=1/0,c=-1/0;a.eachNode(function(t){c=Math.max(t.layout.size,c),d=Math.min(t.layout.size,d)});var u=(l-h)/(c-d);a.eachNode(function(t){var e=this._getNodeQueryTarget(i,t),o=this.query(e,"symbolSize");t.layout.size=c===d?o||d:o||(t.layout.size-d)*u+h},this)}var p=new g;p.clockWise=i.clockWise,p.startAngle=i.startAngle*Math.PI/180,p.clockWise||(p.startAngle=-p.startAngle),p.padding=i.padding*Math.PI/180,p.sort=i.sort,p.sortSub=i.sortSub,p.directed=i.ribbonType,p.run(e);var f=this.query(i,"itemStyle.normal.label.show");if(i.ribbonType){this._buildSectors(i,0,a,i,e),f&&this._buildLabels(i,0,a,i,e);for(var r=0,m=0;r<t.length;r++)this.selectedMap[t[r].name]&&this._buildRibbons(t,r,e[m++],i);i.showScale&&this._buildScales(i,0,a)}else{this._buildNodeIcons(i,0,a,i,e),f&&this._buildLabels(i,0,a,i,e);for(var r=0,m=0;r<t.length;r++)this.selectedMap[t[r].name]&&this._buildEdgeCurves(t,r,e[m++],i,a)}this._initHoverHandler(t,e)}},_getSerieGraphFromDataMatrix:function(t,e){for(var i=[],o=0,r=[],n=0;n<t.matrix.length;n++)r[n]=t.matrix[n].slice();for(var s=t.data||t.nodes,n=0;n<s.length;n++){var a={},h=s[n];h.rawIndex=n;for(var l in h)"name"===l?a.id=h.name:a[l]=h[l];var d=this._getNodeCategory(e,h),c=d?d.name:h.name;if(this.selectedMap[c]=this.isSelected(c),this.selectedMap[c])i.push(a),o++;else{r.splice(o,1);for(var u=0;u<r.length;u++)r[u].splice(o,1)}}var p=f.fromMatrix(i,r,!0);return p.eachNode(function(t){t.layout={size:t.data.outValue},t.rawIndex=t.data.rawIndex}),p.eachEdge(function(t){t.layout={weight:t.data.weight}}),p},_getSerieGraphFromNodeLinks:function(t,e){for(var i=new f(!0),o=t.data||t.nodes,r=0,n=o.length;n>r;r++){var s=o[r];if(s&&!s.ignore){var a=this._getNodeCategory(e,s),h=a?a.name:s.name;if(this.selectedMap[h]=this.isSelected(h),this.selectedMap[h]){var l=i.addNode(s.name,s);l.rawIndex=r}}}for(var r=0,n=t.links.length;n>r;r++){var d=t.links[r],c=d.source,u=d.target;"number"==typeof c&&(c=o[c],c&&(c=c.name)),"number"==typeof u&&(u=o[u],u&&(u=u.name));var p=i.addEdge(c,u,d);p&&(p.rawIndex=r)}return i.eachNode(function(t){var i=t.data.value;if(null==i)if(i=0,e.ribbonType)for(var o=0;o<t.outEdges.length;o++)i+=t.outEdges[o].data.weight||0;else for(var o=0;o<t.edges.length;o++)i+=t.edges[o].data.weight||0;t.layout={size:i}}),i.eachEdge(function(t){t.layout={weight:null==t.data.weight?1:t.data.weight}}),i},_initHoverHandler:function(t,e){var i=t[0],o=e[0],r=this;o.eachNode(function(t){t.shape.onmouseover=function(){o.eachNode(function(t){t.shape.style.opacity=.1,t.labelShape&&(t.labelShape.style.opacity=.1,t.labelShape.modSelf()),t.shape.modSelf()});for(var i=0;i<e.length;i++)for(var n=0;n<e[i].edges.length;n++){var s=e[i].edges[n],a=r._getEdgeQueryTarget(e[i].__serie,s.data);s.shape.style.opacity=.1*r.deepQuery(a,"opacity"),s.shape.modSelf()}t.shape.style.opacity=1,t.labelShape&&(t.labelShape.style.opacity=1);for(var i=0;i<e.length;i++){var h=e[i].getNodeById(t.id);if(h)for(var n=0;n<h.outEdges.length;n++){var s=h.outEdges[n],a=r._getEdgeQueryTarget(e[i].__serie,s.data);s.shape.style.opacity=r.deepQuery(a,"opacity");var l=e[0].getNodeById(s.node2.id);l&&(l.shape&&(l.shape.style.opacity=1),l.labelShape&&(l.labelShape.style.opacity=1))}}r.zr.refreshNextFrame()},t.shape.onmouseout=function(){o.eachNode(function(t){t.shape.style.opacity=1,t.labelShape&&(t.labelShape.style.opacity=1,t.labelShape.modSelf()),t.shape.modSelf()});for(var t=0;t<e.length;t++)for(var n=0;n<e[t].edges.length;n++){var s=e[t].edges[n],a=[s.data,i];s.shape.style.opacity=r.deepQuery(a,"itemStyle.normal.chordStyle.opacity"),s.shape.modSelf()}r.zr.refreshNextFrame()}})},_buildSectors:function(t,e,i,o){var r=this.parseCenter(this.zr,o.center),n=this.parseRadius(this.zr,o.radius),a=o.clockWise,h=a?1:-1;i.eachNode(function(i){var l=this._getNodeCategory(o,i.data),d=this.getColor(l?l.name:i.id),u=i.layout.startAngle/Math.PI*180*h,p=i.layout.endAngle/Math.PI*180*h,f=new s({zlevel:this.getZlevelBase(),style:{x:r[0],y:r[1],r0:n[0],r:n[1],startAngle:u,endAngle:p,brushType:"fill",opacity:1,color:d,clockWise:a},clickable:o.clickable,highlightStyle:{brushType:"fill"}});f.style.lineWidth=this.deepQuery([i.data,o],"itemStyle.normal.borderWidth"),f.highlightStyle.lineWidth=this.deepQuery([i.data,o],"itemStyle.emphasis.borderWidth"),f.style.strokeColor=this.deepQuery([i.data,o],"itemStyle.normal.borderColor"),f.highlightStyle.strokeColor=this.deepQuery([i.data,o],"itemStyle.emphasis.borderColor"),f.style.lineWidth>0&&(f.style.brushType="both"),f.highlightStyle.lineWidth>0&&(f.highlightStyle.brushType="both"),c.pack(f,t,e,i.data,i.rawIndex,i.id,i.category),this.shapeList.push(f),i.shape=f},this)},_buildNodeIcons:function(t,e,i,o){var r=this.parseCenter(this.zr,o.center),n=this.parseRadius(this.zr,o.radius),s=n[1];i.eachNode(function(i){var n=i.layout.startAngle,a=i.layout.endAngle,l=(n+a)/2,d=s*Math.cos(l),u=s*Math.sin(l),p=this._getNodeQueryTarget(o,i.data),f=this._getNodeCategory(o,i.data),g=this.deepQuery(p,"itemStyle.normal.color");g||(g=this.getColor(f?f.name:i.id));var m=new h({zlevel:this.getZlevelBase(),z:1,style:{x:-i.layout.size,y:-i.layout.size,width:2*i.layout.size,height:2*i.layout.size,iconType:this.deepQuery(p,"symbol"),color:g,brushType:"both",lineWidth:this.deepQuery(p,"itemStyle.normal.borderWidth"),strokeColor:this.deepQuery(p,"itemStyle.normal.borderColor")},highlightStyle:{color:this.deepQuery(p,"itemStyle.emphasis.color"),lineWidth:this.deepQuery(p,"itemStyle.emphasis.borderWidth"),strokeColor:this.deepQuery(p,"itemStyle.emphasis.borderColor")},clickable:o.clickable,position:[d+r[0],u+r[1]]});c.pack(m,t,e,i.data,i.rawIndex,i.id,i.category),this.shapeList.push(m),i.shape=m},this)},_buildLabels:function(t,e,i,o){var n=this.query(o,"itemStyle.normal.label.color"),s=this.query(o,"itemStyle.normal.label.rotate"),a=this.query(o,"itemStyle.normal.label.distance"),h=this.parseCenter(this.zr,o.center),l=this.parseRadius(this.zr,o.radius),d=o.clockWise,c=d?1:-1;i.eachNode(function(t){var e=t.layout.startAngle/Math.PI*180*c,i=t.layout.endAngle/Math.PI*180*c,d=(e*-c+i*-c)/2;d%=360,0>d&&(d+=360);var u=90>=d||d>=270;d=d*Math.PI/180;var f=[Math.cos(d),-Math.sin(d)],g=0;g=o.ribbonType?o.showScaleText?35+a:a:a+t.layout.size;var m=p.scale([],f,l[1]+g);p.add(m,m,h);var y={zlevel:this.getZlevelBase()+1,hoverable:!1,style:{text:null==t.data.label?t.id:t.data.label,textAlign:u?"left":"right",color:n||"#000000"}};s?(y.rotation=u?d:Math.PI+d,y.style.x=u?l[1]+g:-l[1]-g,y.style.y=0,y.position=h.slice()):(y.style.x=m[0],y.style.y=m[1]),y.style.textColor=this.deepQuery([t.data,o],"itemStyle.normal.label.textStyle.color")||"#fff",y.style.textFont=this.getFont(this.deepQuery([t.data,o],"itemStyle.normal.label.textStyle")),y=new r(y),this.shapeList.push(y),t.labelShape=y},this)},_buildRibbons:function(t,e,i,o){var r=t[e],n=this.parseCenter(this.zr,o.center),s=this.parseRadius(this.zr,o.radius);i.eachEdge(function(h,l){var d,u=i.getEdge(h.node2,h.node1);if(u&&!h.shape){if(u.shape)return void(h.shape=u.shape);var p=h.layout.startAngle/Math.PI*180,f=h.layout.endAngle/Math.PI*180,g=u.layout.startAngle/Math.PI*180,m=u.layout.endAngle/Math.PI*180;d=this.getColor(1===t.length?h.layout.weight<=u.layout.weight?h.node1.id:h.node2.id:r.name);var y=this._getEdgeQueryTarget(r,h.data),_=this._getEdgeQueryTarget(r,h.data,"emphasis"),v=new a({zlevel:this.getZlevelBase(),style:{x:n[0],y:n[1],r:s[0],source0:p,source1:f,target0:g,target1:m,brushType:"both",opacity:this.deepQuery(y,"opacity"),color:d,lineWidth:this.deepQuery(y,"borderWidth"),strokeColor:this.deepQuery(y,"borderColor"),clockWise:o.clockWise},clickable:o.clickable,highlightStyle:{brushType:"both",opacity:this.deepQuery(_,"opacity"),lineWidth:this.deepQuery(_,"borderWidth"),strokeColor:this.deepQuery(_,"borderColor")}});c.pack(v,r,e,h.data,null==h.rawIndex?l:h.rawIndex,h.data.name||h.node1.id+"-"+h.node2.id,h.node1.id,h.node2.id),this.shapeList.push(v),h.shape=v}},this)},_buildEdgeCurves:function(t,e,i,o,r){var n=t[e],s=this.parseCenter(this.zr,o.center);i.eachEdge(function(t,i){var o=r.getNodeById(t.node1.id),a=r.getNodeById(t.node2.id),h=o.shape,d=a.shape,u=this._getEdgeQueryTarget(n,t.data),p=this._getEdgeQueryTarget(n,t.data,"emphasis"),f=new l({zlevel:this.getZlevelBase(),z:0,style:{xStart:h.position[0],yStart:h.position[1],xEnd:d.position[0],yEnd:d.position[1],cpX1:s[0],cpY1:s[1],lineWidth:this.deepQuery(u,"width"),strokeColor:this.deepQuery(u,"color"),opacity:this.deepQuery(u,"opacity")},highlightStyle:{lineWidth:this.deepQuery(p,"width"),strokeColor:this.deepQuery(p,"color"),opacity:this.deepQuery(p,"opacity")}});c.pack(f,n,e,t.data,null==t.rawIndex?i:t.rawIndex,t.data.name||t.node1.id+"-"+t.node2.id,t.node1.id,t.node2.id),this.shapeList.push(f),t.shape=f},this)},_buildScales:function(t,e,i){var o,s,a=t.clockWise,h=this.parseCenter(this.zr,t.center),l=this.parseRadius(this.zr,t.radius),d=a?1:-1,c=0,u=-1/0;t.showScaleText&&(i.eachNode(function(t){var e=t.data.value;e>u&&(u=e),c+=e}),u>1e10?(o="b",s=1e-9):u>1e7?(o="m",s=1e-6):u>1e4?(o="k",s=.001):(o="",s=1));var f=c/(360-t.padding);i.eachNode(function(e){for(var i=e.layout.startAngle/Math.PI*180,c=e.layout.endAngle/Math.PI*180,u=i;;){if(a&&u>c||!a&&c>u)break;var g=u/180*Math.PI,m=[Math.cos(g),Math.sin(g)],y=p.scale([],m,l[1]+1);p.add(y,y,h);var _=p.scale([],m,l[1]+this.scaleLineLength);p.add(_,_,h);var v=new n({zlevel:this.getZlevelBase()-1,hoverable:!1,style:{xStart:y[0],yStart:y[1],xEnd:_[0],yEnd:_[1],lineCap:"round",brushType:"stroke",strokeColor:"#666",lineWidth:1}});this.shapeList.push(v),u+=d*this.scaleUnitAngle}if(t.showScaleText)for(var x=i,b=5*f*this.scaleUnitAngle,T=0;;){if(a&&x>c||!a&&c>x)break;var g=x;g%=360,0>g&&(g+=360);var S=90>=g||g>=270,C=new r({zlevel:this.getZlevelBase()-1,hoverable:!1,style:{x:S?l[1]+this.scaleLineLength+4:-l[1]-this.scaleLineLength-4,y:0,text:Math.round(10*T)/10+o,textAlign:S?"left":"right"},position:h.slice(),rotation:S?[-g/180*Math.PI,0,0]:[-(g+180)/180*Math.PI,0,0]});this.shapeList.push(C),T+=b*s,x+=d*this.scaleUnitAngle*5}},this)},refresh:function(t){if(t&&(this.option=t,this.series=t.series),this.legend=this.component.legend,this.legend)this.getColor=function(t){return this.legend.getColor(t)},this.isSelected=function(t){return this.legend.isSelected(t)};else{var e={},i=0;this.getColor=function(t){return e[t]?e[t]:(e[t]||(e[t]=this.zr.getColor(i++)),e[t])},this.isSelected=function(){return!0}}this.backupShapeList(),this._init()},reformOption:function(t){var e=u.merge;t=e(t||{},this.ecTheme.chord),t.itemStyle.normal.label.textStyle=e(t.itemStyle.normal.label.textStyle||{},this.ecTheme.textStyle)}},u.inherits(e,o),u.inherits(e,i),t("../chart").define("chord",e),e}),define("echarts/util/shape/Ribbon",["require","zrender/shape/Base","zrender/shape/util/PathProxy","zrender/tool/util","zrender/tool/area"],function(t){function e(t){i.call(this,t),this._pathProxy=new o}var i=t("zrender/shape/Base"),o=t("zrender/shape/util/PathProxy"),r=t("zrender/tool/util"),n=t("zrender/tool/area");return e.prototype={type:"ribbon",buildPath:function(t,e){var i=e.clockWise||!1,o=this._pathProxy;o.begin(t);var r=e.x,n=e.y,s=e.r,a=e.source0/180*Math.PI,h=e.source1/180*Math.PI,l=e.target0/180*Math.PI,d=e.target1/180*Math.PI,c=r+Math.cos(a)*s,u=n+Math.sin(a)*s,p=r+Math.cos(h)*s,f=n+Math.sin(h)*s,g=r+Math.cos(l)*s,m=n+Math.sin(l)*s,y=r+Math.cos(d)*s,_=n+Math.sin(d)*s;o.moveTo(c,u),o.arc(r,n,e.r,a,h,!i),o.bezierCurveTo(.7*(r-p)+p,.7*(n-f)+f,.7*(r-g)+g,.7*(n-m)+m,g,m),(e.source0!==e.target0||e.source1!==e.target1)&&(o.arc(r,n,e.r,l,d,!i),o.bezierCurveTo(.7*(r-y)+y,.7*(n-_)+_,.7*(r-c)+c,.7*(n-u)+u,c,u))},getRect:function(t){return t.__rect?t.__rect:(this._pathProxy.isEmpty()||this.buildPath(null,t),this._pathProxy.fastBoundingRect())},isCover:function(t,e){var i=this.getRect(this.style);return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height?n.isInsidePath(this._pathProxy.pathCommands,0,"fill",t,e):void 0}},r.inherits(e,i),e}),define("echarts/layout/Chord",["require"],function(){var t=function(t){t=t||{},this.sort=t.sort||null,this.sortSub=t.sortSub||null,this.padding=.05,this.startAngle=t.startAngle||0,this.clockWise=null==t.clockWise?!1:t.clockWise,this.center=t.center||[0,0],this.directed=!0};t.prototype.run=function(t){t instanceof Array||(t=[t]);var o=t.length;if(o){for(var r=t[0],n=r.nodes.length,s=[],a=0,h=0;n>h;h++){var l=r.nodes[h],d={size:0,subGroups:[],node:l};s.push(d);for(var c=0,u=0;u<t.length;u++){var p=t[u],f=p.getNodeById(l.id);if(f){d.size+=f.layout.size;for(var g=this.directed?f.outEdges:f.edges,m=0;m<g.length;m++){var y=g[m],_=y.layout.weight;d.subGroups.push({weight:_,edge:y,graph:p}),c+=_}}}a+=d.size;for(var v=d.size/c,m=0;m<d.subGroups.length;m++)d.subGroups[m].weight*=v;"ascending"===this.sortSub?d.subGroups.sort(e):"descending"===this.sort&&(d.subGroups.sort(e),d.subGroups.reverse())}"ascending"===this.sort?s.sort(i):"descending"===this.sort&&(s.sort(i),s.reverse());for(var v=(2*Math.PI-this.padding*n)/a,x=this.startAngle,b=this.clockWise?1:-1,h=0;n>h;h++){var d=s[h];d.node.layout.startAngle=x,d.node.layout.endAngle=x+b*d.size*v,d.node.layout.subGroups=[];for(var m=0;m<d.subGroups.length;m++){var T=d.subGroups[m];T.edge.layout.startAngle=x,x+=b*T.weight*v,T.edge.layout.endAngle=x}x=d.node.layout.endAngle+b*this.padding}}};var e=function(t,e){return t.weight-e.weight},i=function(t,e){return t.size-e.size};return t});